{"version":3,"file":"index.js","sources":["../js/animframe_polyfill.js","../js/tile.js","../js/grid.js","../js/keyboard_input_manager.js","../js/html_actuator.js","../js/local_storage_manager.js","../js/game_manager.js","../src/tool.js","../src/index.js"],"sourcesContent":["(function () {\n  var lastTime = 0;\n  var vendors = ['webkit', 'moz'];\n  for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n    window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n      window[vendors[x] + 'CancelRequestAnimationFrame'];\n  }\n\n  if (!window.requestAnimationFrame) {\n    window.requestAnimationFrame = function (callback) {\n      var currTime = new Date().getTime();\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n      var id = window.setTimeout(function () {\n        callback(currTime + timeToCall);\n      },\n      timeToCall);\n      lastTime = currTime + timeToCall;\n      return id;\n    };\n  }\n\n  if (!window.cancelAnimationFrame) {\n    window.cancelAnimationFrame = function (id) {\n      clearTimeout(id);\n    };\n  }\n}());\n","function Tile(position, value) {\n  this.x                = position.x;\n  this.y                = position.y;\n  this.value            = value || 2;\n\n  this.previousPosition = null;\n  this.mergedFrom       = null; // Tracks tiles that merged together\n}\n\nTile.prototype.savePosition = function () {\n  this.previousPosition = { x: this.x, y: this.y };\n};\n\nTile.prototype.updatePosition = function (position) {\n  this.x = position.x;\n  this.y = position.y;\n};\n\nTile.prototype.serialize = function () {\n  return {\n    position: {\n      x: this.x,\n      y: this.y\n    },\n    value: this.value\n  };\n};\n\nexport default Tile;\n","import Tile from './tile';\n\nfunction Grid(size, previousState) {\n  this.size = size;\n  this.cells = previousState ? this.fromState(previousState) : this.empty();\n}\n\n// Build a grid of the specified size\nGrid.prototype.empty = function () {\n  var cells = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cells[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      row.push(null);\n    }\n  }\n\n  return cells;\n};\n\nGrid.prototype.fromState = function (state) {\n  var cells = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cells[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      var tile = state[x][y];\n      row.push(tile ? new Tile(tile.position, tile.value) : null);\n    }\n  }\n\n  return cells;\n};\n\n// Find the first available random position\nGrid.prototype.randomAvailableCell = function () {\n  var cells = this.availableCells();\n\n  if (cells.length) {\n    return cells[Math.floor(Math.random() * cells.length)];\n  }\n};\n\nGrid.prototype.availableCells = function () {\n  var cells = [];\n\n  this.eachCell(function (x, y, tile) {\n    if (!tile) {\n      cells.push({ x: x, y: y });\n    }\n  });\n\n  return cells;\n};\n\n// Call callback for every cell\nGrid.prototype.eachCell = function (callback) {\n  for (var x = 0; x < this.size; x++) {\n    for (var y = 0; y < this.size; y++) {\n      callback(x, y, this.cells[x][y]);\n    }\n  }\n};\n\n// Check if there are any cells available\nGrid.prototype.cellsAvailable = function () {\n  return !!this.availableCells().length;\n};\n\n// Check if the specified cell is taken\nGrid.prototype.cellAvailable = function (cell) {\n  return !this.cellOccupied(cell);\n};\n\nGrid.prototype.cellOccupied = function (cell) {\n  return !!this.cellContent(cell);\n};\n\nGrid.prototype.cellContent = function (cell) {\n  if (this.withinBounds(cell)) {\n    return this.cells[cell.x][cell.y];\n  } else {\n    return null;\n  }\n};\n\n// Inserts a tile at its position\nGrid.prototype.insertTile = function (tile) {\n  this.cells[tile.x][tile.y] = tile;\n};\n\nGrid.prototype.removeTile = function (tile) {\n  this.cells[tile.x][tile.y] = null;\n};\n\nGrid.prototype.withinBounds = function (position) {\n  return position.x >= 0 && position.x < this.size &&\n         position.y >= 0 && position.y < this.size;\n};\n\nGrid.prototype.serialize = function () {\n  var cellState = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cellState[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      row.push(this.cells[x][y] ? this.cells[x][y].serialize() : null);\n    }\n  }\n\n  return {\n    size: this.size,\n    cells: cellState\n  };\n};\n\nexport default Grid;\n","/**\n * @param {GameConfig} config\n * @constructor\n */\nfunction KeyboardInputManager(config) {\n  this.config = config;\n  this.events = {};\n\n  if (window.navigator.msPointerEnabled) {\n    //Internet Explorer 10 style\n    this.eventTouchstart    = \"MSPointerDown\";\n    this.eventTouchmove     = \"MSPointerMove\";\n    this.eventTouchend      = \"MSPointerUp\";\n  } else {\n    this.eventTouchstart    = \"touchstart\";\n    this.eventTouchmove     = \"touchmove\";\n    this.eventTouchend      = \"touchend\";\n  }\n\n  this.listen();\n}\n\nKeyboardInputManager.prototype.on = function (event, callback) {\n  if (!this.events[event]) {\n    this.events[event] = [];\n  }\n  this.events[event].push(callback);\n};\n\nKeyboardInputManager.prototype.emit = function (event, data) {\n  var callbacks = this.events[event];\n  if (callbacks) {\n    callbacks.forEach(function (callback) {\n      callback(data);\n    });\n  }\n};\n\nKeyboardInputManager.prototype.listen = function () {\n  var self = this;\n\n  var map = {\n    38: 0, // Up\n    39: 1, // Right\n    40: 2, // Down\n    37: 3, // Left\n    75: 0, // Vim up\n    76: 1, // Vim right\n    74: 2, // Vim down\n    72: 3, // Vim left\n    87: 0, // W\n    68: 1, // D\n    83: 2, // S\n    65: 3  // A\n  };\n\n  // Respond to direction keys\n  document.addEventListener(\"keydown\", function (event) {\n    var modifiers = event.altKey || event.ctrlKey || event.metaKey ||\n                    event.shiftKey;\n    var mapped    = map[event.which];\n\n    // Ignore the event if it's happening in a text field\n    if (self.targetIsInput(event)) return;\n\n    if (!modifiers) {\n      if (mapped !== undefined) {\n        event.preventDefault();\n        self.emit(\"move\", mapped);\n      }\n    }\n\n    // R key restarts the game\n    if (!modifiers && event.which === 82) {\n      self.restart.call(self, event);\n    }\n  });\n\n  // Respond to button presses\n  this.bindButtonPress(this.config.retryButton, this.restart);\n  this.bindButtonPress(\".restart-button\", this.restart);\n  this.bindButtonPress(this.config.keepPlayingButton, this.keepPlaying);\n\n  // Respond to swipe events\n  var touchStartClientX, touchStartClientY;\n  var gameContainer = this.config.gameContainer;\n\n  gameContainer.addEventListener(this.eventTouchstart, function (event) {\n    if ((!window.navigator.msPointerEnabled && event.touches.length > 1) ||\n        event.targetTouches.length > 1 ||\n        self.targetIsInput(event)) {\n      return; // Ignore if touching with more than 1 finger or touching input\n    }\n\n    if (window.navigator.msPointerEnabled) {\n      touchStartClientX = event.pageX;\n      touchStartClientY = event.pageY;\n    } else {\n      touchStartClientX = event.touches[0].clientX;\n      touchStartClientY = event.touches[0].clientY;\n    }\n\n    event.preventDefault();\n  });\n\n  gameContainer.addEventListener(this.eventTouchmove, function (event) {\n    event.preventDefault();\n  });\n\n  gameContainer.addEventListener(this.eventTouchend, function (event) {\n    if ((!window.navigator.msPointerEnabled && event.touches.length > 0) ||\n        event.targetTouches.length > 0 ||\n        self.targetIsInput(event)) {\n      return; // Ignore if still touching with one or more fingers or input\n    }\n\n    var touchEndClientX, touchEndClientY;\n\n    if (window.navigator.msPointerEnabled) {\n      touchEndClientX = event.pageX;\n      touchEndClientY = event.pageY;\n    } else {\n      touchEndClientX = event.changedTouches[0].clientX;\n      touchEndClientY = event.changedTouches[0].clientY;\n    }\n\n    var dx = touchEndClientX - touchStartClientX;\n    var absDx = Math.abs(dx);\n\n    var dy = touchEndClientY - touchStartClientY;\n    var absDy = Math.abs(dy);\n\n    if (Math.max(absDx, absDy) > 10) {\n      // (right : left) : (down : up)\n      self.emit(\"move\", absDx > absDy ? (dx > 0 ? 1 : 3) : (dy > 0 ? 2 : 0));\n    }\n  });\n};\n\nKeyboardInputManager.prototype.restart = function (event) {\n  event.preventDefault();\n  this.emit(\"restart\");\n};\n\nKeyboardInputManager.prototype.keepPlaying = function (event) {\n  event.preventDefault();\n  this.emit(\"keepPlaying\");\n};\n\nKeyboardInputManager.prototype.bindButtonPress = function (selector, fn) {\n  var button = selector instanceof HTMLElement ? selector : document.querySelector(selector);\n  button.addEventListener(\"click\", fn.bind(this));\n  button.addEventListener(this.eventTouchend, fn.bind(this));\n};\n\nKeyboardInputManager.prototype.targetIsInput = function (event) {\n  return event.target.tagName.toLowerCase() === \"input\";\n};\n\nexport default KeyboardInputManager;\n","/**\n * @param {GameConfig} config\n * @constructor\n */\nfunction HTMLActuator(config) {\n  this.tileContainer    = config.tileContainer;\n  this.scoreContainer   = document.querySelector(\".score-container\");\n  this.bestContainer    = document.querySelector(\".best-container\");\n  this.messageContainer = config.gameMessageContainer;\n\n  this.score = 0;\n  this.config = config;\n}\n\nHTMLActuator.prototype.actuate = function (grid, metadata) {\n  var self = this;\n\n  window.requestAnimationFrame(function () {\n    self.clearContainer(self.tileContainer);\n\n    grid.cells.forEach(function (column) {\n      column.forEach(function (cell) {\n        if (cell) {\n          self.addTile(cell);\n        }\n      });\n    });\n\n    self.updateScore(metadata.score);\n    self.updateBestScore(metadata.bestScore);\n\n    if (metadata.terminated) {\n      if (metadata.over) {\n        self.message(false); // You lose\n      } else if (metadata.won) {\n        self.message(true); // You win!\n      }\n    }\n\n  });\n};\n\n// Continues the game (both restart and keep playing)\nHTMLActuator.prototype.continueGame = function () {\n  this.clearMessage();\n};\n\nHTMLActuator.prototype.clearContainer = function (container) {\n  while (container.firstChild) {\n    container.removeChild(container.firstChild);\n  }\n};\n\nHTMLActuator.prototype.addTile = function (tile) {\n  var self = this;\n\n  var wrapper   = document.createElement(\"div\");\n  var inner     = document.createElement(\"div\");\n  var position  = tile.previousPosition || { x: tile.x, y: tile.y };\n  var positionClass = this.positionClass(position);\n\n  // We can't use classlist because it somehow glitches when replacing classes\n  var classes = [\"tile\", \"tile-\" + tile.value, positionClass];\n\n  if (tile.value > this.config.endScore) classes.push(\"tile-super\");\n\n  this.applyClasses(wrapper, classes);\n\n  inner.classList.add(\"tile-inner\");\n  inner.textContent = tile.value;\n\n  if (tile.previousPosition) {\n    // Make sure that the tile gets rendered in the previous position first\n    window.requestAnimationFrame(function () {\n      classes[2] = self.positionClass({ x: tile.x, y: tile.y });\n      self.applyClasses(wrapper, classes); // Update the position\n    });\n  } else if (tile.mergedFrom) {\n    classes.push(\"tile-merged\");\n    this.applyClasses(wrapper, classes);\n\n    // Render the tiles that merged\n    tile.mergedFrom.forEach(function (merged) {\n      self.addTile(merged);\n    });\n  } else {\n    classes.push(\"tile-new\");\n    this.applyClasses(wrapper, classes);\n  }\n\n  // Add the inner part of the tile to the wrapper\n  wrapper.appendChild(inner);\n\n  // Put the tile on the board\n  this.tileContainer.appendChild(wrapper);\n};\n\nHTMLActuator.prototype.applyClasses = function (element, classes) {\n  element.setAttribute(\"class\", classes.join(\" \"));\n};\n\nHTMLActuator.prototype.normalizePosition = function (position) {\n  return { x: position.x + 1, y: position.y + 1 };\n};\n\nHTMLActuator.prototype.positionClass = function (position) {\n  position = this.normalizePosition(position);\n  return \"tile-position-\" + position.x + \"-\" + position.y;\n};\n\nHTMLActuator.prototype.updateScore = function (score) {\n  this.clearContainer(this.scoreContainer);\n\n  var difference = score - this.score;\n  this.score = score;\n\n  this.scoreContainer.textContent = this.score;\n\n  if (difference > 0) {\n    var addition = document.createElement(\"div\");\n    addition.classList.add(\"score-addition\");\n    addition.textContent = \"+\" + difference;\n\n    this.scoreContainer.appendChild(addition);\n  }\n};\n\nHTMLActuator.prototype.updateBestScore = function (bestScore) {\n  this.bestContainer.textContent = bestScore;\n};\n\nHTMLActuator.prototype.message = function (won) {\n  var type    = won ? this.config.gameWinMessage : this.config.gameLoseMessage;\n  var message = won ? this.config.playerWinMessage : this.config.playerLoseMessage;\n\n  this.messageContainer.classList.add(type);\n  this.messageContainer.getElementsByTagName(\"p\")[0].textContent = message;\n};\n\nHTMLActuator.prototype.clearMessage = function () {\n  // IE only takes one value to remove at a time.\n  this.messageContainer.classList.remove(\"game-won\");\n  this.messageContainer.classList.remove(\"game-over\");\n};\n\nexport default HTMLActuator;\n","window.fakeStorage = {\n  _data: {},\n\n  setItem: function (id, val) {\n    return this._data[id] = String(val);\n  },\n\n  getItem: function (id) {\n    return this._data.hasOwnProperty(id) ? this._data[id] : undefined;\n  },\n\n  removeItem: function (id) {\n    return delete this._data[id];\n  },\n\n  clear: function () {\n    return this._data = {};\n  }\n};\n\nfunction LocalStorageManager() {\n  this.bestScoreKey     = \"bestScore\";\n  this.gameStateKey     = \"gameState\";\n\n  var supported = this.localStorageSupported();\n  this.storage = supported ? window.localStorage : window.fakeStorage;\n}\n\nLocalStorageManager.prototype.localStorageSupported = function () {\n  var testKey = \"test\";\n\n  try {\n    var storage = window.localStorage;\n    storage.setItem(testKey, \"1\");\n    storage.removeItem(testKey);\n    return true;\n  } catch (error) {\n    return false;\n  }\n};\n\n// Best score getters/setters\nLocalStorageManager.prototype.getBestScore = function () {\n  return this.storage.getItem(this.bestScoreKey) || 0;\n};\n\nLocalStorageManager.prototype.setBestScore = function (score) {\n  this.storage.setItem(this.bestScoreKey, score);\n};\n\n// Game state getters/setters and clearing\nLocalStorageManager.prototype.getGameState = function () {\n  var stateJSON = this.storage.getItem(this.gameStateKey);\n  return stateJSON ? JSON.parse(stateJSON) : null;\n};\n\nLocalStorageManager.prototype.setGameState = function (gameState) {\n  this.storage.setItem(this.gameStateKey, JSON.stringify(gameState));\n};\n\nLocalStorageManager.prototype.clearGameState = function () {\n  this.storage.removeItem(this.gameStateKey);\n};\n\nexport default LocalStorageManager;\n","import Grid from './grid';\nimport Tile from './tile';\nimport KeyboardInputManager from '../js/keyboard_input_manager'\nimport HTMLActuator from '../js/html_actuator'\nimport LocalStorageManager from '../js/local_storage_manager'\n\n/**\n * Core Game Manager\n * @param {GameConfig} config\n * @constructor\n */\nfunction GameManager(config) {\n  this.config         = config;\n  this.size           = config.size;\n  this.inputManager   = new KeyboardInputManager(config);\n  this.storageManager = new LocalStorageManager(config);\n  this.actuator       = new HTMLActuator(config);\n\n  this.startTiles     = config.startTiles;\n\n  this.inputManager.on(\"move\", this.move.bind(this));\n  this.inputManager.on(\"restart\", this.restart.bind(this));\n  this.inputManager.on(\"keepPlaying\", this.keepPlaying.bind(this));\n\n  this.setup();\n}\n\n// Restart the game\nGameManager.prototype.restart = function () {\n  this.storageManager.clearGameState();\n  this.actuator.continueGame(); // Clear the game won/lost message\n  this.setup();\n};\n\n// Keep playing after winning (allows going over 2048)\nGameManager.prototype.keepPlaying = function () {\n  this.keepPlaying = true;\n  this.actuator.continueGame(); // Clear the game won/lost message\n};\n\n// Return true if the game is lost, or has won and the user hasn't kept playing\nGameManager.prototype.isGameTerminated = function () {\n  return this.over || (this.won && !this.keepPlaying);\n};\n\n// Set up the game\nGameManager.prototype.setup = function () {\n  var previousState = this.storageManager.getGameState();\n\n  // Reload the game from a previous game if present\n  if (previousState) {\n    this.grid        = new Grid(previousState.grid.size,\n                                previousState.grid.cells); // Reload grid\n    this.score       = previousState.score;\n    this.over        = previousState.over;\n    this.won         = previousState.won;\n    this.keepPlaying = previousState.keepPlaying;\n  } else {\n    this.grid        = new Grid(this.size);\n    this.score       = 0;\n    this.over        = false;\n    this.won         = false;\n    this.keepPlaying = false;\n\n    // Add the initial tiles\n    this.addStartTiles();\n  }\n\n  // Update the actuator\n  this.actuate();\n};\n\n// Set up the initial tiles to start the game with\nGameManager.prototype.addStartTiles = function () {\n  for (var i = 0; i < this.startTiles; i++) {\n    this.addRandomTile();\n  }\n};\n\n// Adds a tile in a random position\nGameManager.prototype.addRandomTile = function () {\n  if (this.grid.cellsAvailable()) {\n    var value = Math.random() < 0.9 ? 2 : 4;\n    var tile = new Tile(this.grid.randomAvailableCell(), value);\n\n    this.grid.insertTile(tile);\n  }\n};\n\n// Sends the updated grid to the actuator\nGameManager.prototype.actuate = function () {\n  if (this.storageManager.getBestScore() < this.score) {\n    this.storageManager.setBestScore(this.score);\n  }\n\n  // Clear the state when the game is over (game over only, not win)\n  if (this.over) {\n    this.storageManager.clearGameState();\n  } else {\n    this.storageManager.setGameState(this.serialize());\n  }\n\n  this.actuator.actuate(this.grid, {\n    score:      this.score,\n    over:       this.over,\n    won:        this.won,\n    bestScore:  this.storageManager.getBestScore(),\n    terminated: this.isGameTerminated()\n  });\n\n};\n\n// Represent the current game as an object\nGameManager.prototype.serialize = function () {\n  return {\n    grid:        this.grid.serialize(),\n    score:       this.score,\n    over:        this.over,\n    won:         this.won,\n    keepPlaying: this.keepPlaying\n  };\n};\n\n// Save all tile positions and remove merger info\nGameManager.prototype.prepareTiles = function () {\n  this.grid.eachCell(function (x, y, tile) {\n    if (tile) {\n      tile.mergedFrom = null;\n      tile.savePosition();\n    }\n  });\n};\n\n// Move a tile and its representation\nGameManager.prototype.moveTile = function (tile, cell) {\n  this.grid.cells[tile.x][tile.y] = null;\n  this.grid.cells[cell.x][cell.y] = tile;\n  tile.updatePosition(cell);\n};\n\n// Move tiles on the grid in the specified direction\nGameManager.prototype.move = function (direction) {\n  // 0: up, 1: right, 2: down, 3: left\n  var self = this;\n  var endScore = this.config.endScore;\n\n  if (this.isGameTerminated()) return; // Don't do anything if the game's over\n\n  var cell, tile;\n\n  var vector     = this.getVector(direction);\n  var traversals = this.buildTraversals(vector);\n  var moved      = false;\n\n  // Save the current tile positions and remove merger information\n  this.prepareTiles();\n\n  // Traverse the grid in the right direction and move tiles\n  traversals.x.forEach(function (x) {\n    traversals.y.forEach(function (y) {\n      cell = { x: x, y: y };\n      tile = self.grid.cellContent(cell);\n\n      if (tile) {\n        var positions = self.findFarthestPosition(cell, vector);\n        var next      = self.grid.cellContent(positions.next);\n\n        // Only one merger per row traversal?\n        if (next && next.value === tile.value && !next.mergedFrom) {\n          var merged = new Tile(positions.next, tile.value * 2);\n          merged.mergedFrom = [tile, next];\n\n          self.grid.insertTile(merged);\n          self.grid.removeTile(tile);\n\n          // Converge the two tiles' positions\n          tile.updatePosition(positions.next);\n\n          // Update the score\n          self.score += merged.value;\n\n          // The mighty 2048 tile\n          if (merged.value === endScore) self.won = true;\n        } else {\n          self.moveTile(tile, positions.farthest);\n        }\n\n        if (!self.positionsEqual(cell, tile)) {\n          moved = true; // The tile moved from its original cell!\n        }\n      }\n    });\n  });\n\n  if (moved) {\n    this.addRandomTile();\n\n    if (!this.movesAvailable()) {\n      this.over = true; // Game over!\n    }\n\n    this.actuate();\n  }\n};\n\n// Get the vector representing the chosen direction\nGameManager.prototype.getVector = function (direction) {\n  // Vectors representing tile movement\n  var map = {\n    0: { x: 0,  y: -1 }, // Up\n    1: { x: 1,  y: 0 },  // Right\n    2: { x: 0,  y: 1 },  // Down\n    3: { x: -1, y: 0 }   // Left\n  };\n\n  return map[direction];\n};\n\n// Build a list of positions to traverse in the right order\nGameManager.prototype.buildTraversals = function (vector) {\n  var traversals = { x: [], y: [] };\n\n  for (var pos = 0; pos < this.size; pos++) {\n    traversals.x.push(pos);\n    traversals.y.push(pos);\n  }\n\n  // Always traverse from the farthest cell in the chosen direction\n  if (vector.x === 1) traversals.x = traversals.x.reverse();\n  if (vector.y === 1) traversals.y = traversals.y.reverse();\n\n  return traversals;\n};\n\nGameManager.prototype.findFarthestPosition = function (cell, vector) {\n  var previous;\n\n  // Progress towards the vector direction until an obstacle is found\n  do {\n    previous = cell;\n    cell     = { x: previous.x + vector.x, y: previous.y + vector.y };\n  } while (this.grid.withinBounds(cell) &&\n           this.grid.cellAvailable(cell));\n\n  return {\n    farthest: previous,\n    next: cell // Used to check if a merge is required\n  };\n};\n\nGameManager.prototype.movesAvailable = function () {\n  return this.grid.cellsAvailable() || this.tileMatchesAvailable();\n};\n\n// Check for available matches between tiles (more expensive check)\nGameManager.prototype.tileMatchesAvailable = function () {\n  var self = this;\n\n  var tile;\n\n  for (var x = 0; x < this.size; x++) {\n    for (var y = 0; y < this.size; y++) {\n      tile = this.grid.cellContent({ x: x, y: y });\n\n      if (tile) {\n        for (var direction = 0; direction < 4; direction++) {\n          var vector = self.getVector(direction);\n          var cell   = { x: x + vector.x, y: y + vector.y };\n\n          var other  = self.grid.cellContent(cell);\n\n          if (other && other.value === tile.value) {\n            return true; // These two tiles can be merged\n          }\n        }\n      }\n    }\n  }\n\n  return false;\n};\n\nGameManager.prototype.positionsEqual = function (first, second) {\n  return first.x === second.x && first.y === second.y;\n};\n\nexport default GameManager;\n","/**\n * 2018/1/26\n *\n * Copyright(c) Alibaba Group Holding Limited.\n *\n * Authors:\n *   乔杨 <peiqiao.ppq@alipay.com>\n */\n\n'use strict'\n\n/**\n * create Element\n * @param {string} tagName\n * @param {?Object} attr\n * @param {?Array<Element>} children\n * @return {Element}\n */\nexport function createElement (tagName, attr, children) {\n  const node = document.createElement(tagName)\n  Object.assign(node, attr);\n  (children || []).forEach(child => {\n    node.appendChild(child)\n  })\n  return node\n}\n","/**\n * 2018/1/25\n *\n * Copyright(c) Alibaba Group Holding Limited.\n *\n * Authors:\n *   乔杨 <peiqiao.ppq@alipay.com>\n */\n\n'use strict'\n\nimport '../js/animframe_polyfill'\n\nimport GameManager from '../js/game_manager'\nimport { createElement } from './tool'\n\n/**\n * default game config\n * @type {GameConfig}\n */\nconst DEFAULT_GAME_CONFIG = {\n  size: 4,\n  startTiles: 2,\n  endScore: 2048,\n  gameWinMessage: 'game-won',\n  gameLoseMessage: 'game-over',\n  playerWinMessage: 'You Win!',\n  playerLoseMessage: 'Game Over!',\n  newGameButtonText: 'New Game',\n  title: '2048',\n  desc: 'Join the numbers and get to the 2048 tile!'\n}\n\nclass Game {\n  /**\n   * @typedef {Object} GameConfig\n   * @property {number} size - size of the grid\n   * @property {Element} gameContainer - the main container of the game\n   * @property {?number} startTiles - numbers of tiles in the beginning\n   * @property {?number} endScore - number of the score to end the game\n   * @property {?string} title\n   * @property {?string} desc\n   * @property {?string} gameWinMessage\n   * @property {?string} gameLoseMessage\n   * @property {?string} playerWinMessage\n   * @property {?string} playerLoseMessage\n   * @property {?Element} gameMessageContainer\n   * @property {?Element} tileContainer\n   * @property {?Element} retryButton\n   * @property {?Element} keepPlayingButton\n   * @property {?Element} scoreContainer\n   * @property {?Element} bestContainer\n   */\n\n  /**\n   * Game Manager Class\n   * @param {GameConfig} config\n   */\n  constructor (config) {\n    this.config = Object.assign({}, DEFAULT_GAME_CONFIG, config)\n    this.initDOM()\n    this.gameManager = new GameManager(this.config)\n  }\n\n  /**\n   * init default DOM element\n   * @return {Object}\n   */\n  initDOM () {\n    const config = this.config\n    config.scoreContainer = config.scoreContainer || createElement('div', { className: 'score-container', innerText: '0' })\n    config.bestContainer = config.bestContainer || createElement('div', { className: 'best-container', innerText: '0' })\n    config.retryButton = config.retryButton || createElement('div', { className: 'retry-button', innerText: 'Try again' })\n    config.keepPlayingButton = config.keepPlayingButton || createElement('div', { className: 'keep-playing-button', innerText: 'Keep going' })\n    config.gameMessageContainer = config.gameMessageContainer || createElement('div', { className: 'game-message' }, [\n      createElement('p'),\n      createElement('div', { className: 'lower' }, [\n        config.keepPlayingButton,\n        config.retryButton\n      ])\n    ])\n    config.tileContainer = config.tileContainer || createElement('div', { className: 'tile-container' })\n    config.gridContainer = createElement('div', { className: 'grid-container' }, Array.apply(null, Array(config.size)).map(() => createElement('div', { className: 'grid-row' }, Array.apply(null, Array(config.size)).map(() => createElement('div', { className: 'grid-cell' })))))\n    if (!config.gameContainer || !(config.gameContainer instanceof window.HTMLElement)) {\n      throw new TypeError('gameContainer should be an HTMLElement! did you forget to pass an element to the Game constructor?')\n    }\n    config.gameContainer.appendChild(createElement('div', { className: 'heading' }, [\n      createElement('h1', { className: 'title', innerText: config.title }),\n      createElement('div', { className: 'scores-container' }, [\n        config.scoreContainer,\n        config.bestContainer\n      ])\n    ]))\n    config.gameContainer.appendChild(createElement('div', { className: 'above-game' }, [\n      createElement('div', { className: 'game-intro', innerText: config.desc }),\n      createElement('div', { className: 'restart-button', innerText: config.newGameButtonText })\n    ]))\n    config.gameContainer.appendChild(createElement('div', { className: 'game-container' }, [\n      config.gameMessageContainer,\n      config.gridContainer,\n      config.tileContainer\n    ]))\n  }\n}\n\nexport default Game\n"],"names":["lastTime","vendors","x","length","window","requestAnimationFrame","cancelAnimationFrame","callback","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","Tile","position","value","y","previousPosition","mergedFrom","prototype","savePosition","updatePosition","serialize","Grid","size","previousState","cells","fromState","empty","row","push","state","tile","randomAvailableCell","availableCells","floor","random","eachCell","cellsAvailable","cellAvailable","cell","cellOccupied","cellContent","withinBounds","insertTile","removeTile","cellState","KeyboardInputManager","config","events","navigator","msPointerEnabled","eventTouchstart","eventTouchmove","eventTouchend","listen","on","event","emit","data","callbacks","forEach","self","map","addEventListener","modifiers","altKey","ctrlKey","metaKey","shiftKey","mapped","which","targetIsInput","undefined","preventDefault","restart","call","bindButtonPress","retryButton","keepPlayingButton","keepPlaying","touchStartClientX","touchStartClientY","gameContainer","touches","targetTouches","pageX","pageY","clientX","clientY","touchEndClientX","touchEndClientY","changedTouches","dx","absDx","abs","dy","absDy","selector","fn","button","HTMLElement","document","querySelector","bind","target","tagName","toLowerCase","HTMLActuator","tileContainer","scoreContainer","bestContainer","messageContainer","gameMessageContainer","score","actuate","grid","metadata","clearContainer","column","addTile","updateScore","updateBestScore","bestScore","terminated","over","message","won","continueGame","clearMessage","container","firstChild","removeChild","wrapper","createElement","inner","positionClass","classes","endScore","applyClasses","classList","add","textContent","merged","appendChild","element","setAttribute","join","normalizePosition","difference","addition","type","gameWinMessage","gameLoseMessage","playerWinMessage","playerLoseMessage","getElementsByTagName","remove","fakeStorage","val","_data","String","hasOwnProperty","LocalStorageManager","bestScoreKey","gameStateKey","supported","localStorageSupported","storage","localStorage","testKey","setItem","removeItem","error","getBestScore","getItem","setBestScore","getGameState","stateJSON","JSON","parse","setGameState","gameState","stringify","clearGameState","GameManager","inputManager","storageManager","actuator","startTiles","move","setup","isGameTerminated","addStartTiles","i","addRandomTile","prepareTiles","moveTile","direction","vector","getVector","traversals","buildTraversals","moved","positions","findFarthestPosition","next","farthest","positionsEqual","movesAvailable","pos","reverse","previous","tileMatchesAvailable","other","first","second","attr","children","node","assign","child","DEFAULT_GAME_CONFIG","Game","Object","initDOM","gameManager","className","innerText","gridContainer","Array","apply","TypeError","title","desc","newGameButtonText"],"mappings":"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"}